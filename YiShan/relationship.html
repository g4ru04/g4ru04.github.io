<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF8"/>
    <title>WithYiShan</title>

    <meta property="og:title" content="Relationship with Yi Shan"/>
    <meta property="og:description" content="I Like Me Better When I'm With You"/>
    <meta property="og:image" content="https://g4ru04.github.io/YiShan/we.jpg"/>
    <meta property="og:url" content="https://g4ru04.github.io/YiShan"/>
    <meta property="og:type" content="website"/>
    <meta name="description" content="Relationship with Yi Shan"/>

    <link rel="icon" href="https://g4ru04.github.io/YiShan/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="https://g4ru04.github.io/YiShan/favicon.ico" type="image/x-icon" />
    <link rel="preload" as="image" href="./pictures/we1.jpg">
    <link rel="preload" as="image" href="./pictures/we2.jpg">
    <link rel="preload" as="audio" href="./ed-perfect.mp3">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script>
      const expectedHash = "c0d7c54022345b39c9be73e19b30ccb040ba03b1fefb2566a9f510a09aba4796";
      async function sha256(str) {
        const encoder = new TextEncoder();
        const data = encoder.encode(str);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      }

      async function checkPassword() {
        const pwd = prompt("請輸入密碼：");
        const hash = await sha256(pwd);
        if (hash !== expectedHash) {
          window.location.href = "/";
        }
      }

      checkPassword();
    </script>
  <style>
    .full {
      position: fixed;
      bottom: 40px;
      right: 40px;
      width: calc(100vw - 80px);
      height: calc(100vh - 80px);
      background-repeat: no-repeat;
      background-size: contain;
      background-position:center;
      text-align: center;
      opacity: 0.8;
    }
    .image-container .low-res {
      filter: blur(10px);
      transform: scale(1.1);
    }
    .image-container .full-res.hidden {
      opacity: 0;
    }
    .image-container .full-res.loaded {
      opacity: 1;
    }
    body{
      background-color: #333;
      background: url(./galaxy.gif) repeat #0a0a0a !important;
      background-size: 1920px auto;
    }
    .center{
      font-size: 1rem;
      /*font-weight: bold;*/
      width: 400px;
      height: 60px;
      margin: auto;
      position:fixed;
      top: calc( 50vh + 120px );
      left: calc( 50vw - 200px );
      background: radial-gradient(300px 40px ellipse,#900, transparent 80%);
      color: #dda700;
    }
    .playButton {
      position: fixed;
      top: calc(50vh + 30px);
      left: calc(50vw - 40px);
      width: 80px;
      height: 80px;
      background-repeat: no-repeat;
      background-size: contain;
      background-position:center;
      text-align: center;
      opacity: 0.3;
      background-image:url(./play.png);
    }
    /*#pic1 {*/
    /*  opacity: 0.6;*/
    /*  background-image:url(./we2.jpg);*/
    /*}*/
    /*#pic2, #pic3,#pic4,#pic5,#pic6,#pic7,#pic8,#pic9,#pic10,#pic11,#pic12,#pic13 {*/
    /*  display:none;*/
    /*  opacity: 0.6;*/
    /*  background-image:url(./we1.jpg);*/
    /*}*/
  </style>
  </head>
  <body>
    <div class='full'>
      <div class='full' id='pics' style=''></div>
      <div class='playButton' id='playButton' style=''></div>
      <div class='center'></div>
    </div>

    <audio loop=true autoplay=true id="piano">
      <source src="./ed-perfect.mp3" >
    </audio>
  <script>
  function setTime(time){
    let thatDay = new Date('2025/07/12 21:00').getTime();
    let distance = (new Date(time).getTime() - thatDay);
    let distanceSec = Math.floor(distance / 1000);
    let distanceMin = Math.floor(distanceSec / 60);
    let distanceHour = Math.floor(distanceMin / 60);
    let distanceDay = Math.floor(distanceHour / 24);
    let distanceMonth = Math.floor(distanceDay / 30);
    $('.center').html('與妳交往的<br>'
      + '<div style="font-size:1.2rem">第 '+ (distanceDay)+' 天'
      + '又 '+ (distanceHour % 24)+' 小時'
      + ' '+ (''+(distanceMin % 60)).padStart(2,'0')+' 分'
      + ' '+ (''+(distanceSec % 60)).padStart(2,'0')+' 秒</div>');
  }

  let counter1 = 0;
  let counter2 = 1;
  let counter3 = 2;
  let counter4 = 3;
  const picIDs = [
    'we1', 'we2', 'we3', 'we4', 'we5', 'we6', 'we7', 'we8', 'we9', 'we10',
    'we11', 'we12', 'we13', 'we14', 'we15', 'we16', 'we17', 'we18', 'we19','we20',
    'we21', 'we22', 'we23', 'we24', 'we25','we26', 'we27', 'we28', 'we29', 'we30',
    'we31', 'we32', 'we33', 'we34', 'we35', 'we36', 'we37', 'we38', 'we39',// 'we40',
  ];
  function changePic(ms=800){
    $(`#${picIDs[counter1]}`).fadeOut(ms);
    // 下張圖片先藏起來
    $(`#${picIDs[counter2]}`).css({
      "opacity": "0.6",
      "visibility": "visible",
      "display": "none",
    });
    $(`#${picIDs[counter2]}`).fadeIn(ms);
    // 先讀下兩張照片
    $(`#${picIDs[counter3]},#${picIDs[counter4]}`).css({
      "opacity": "0",
      "visibility": "hidden",
      "display": "block",
    });

    counter2 = (counter1+2) % picIDs.length;
    counter3 = (counter1+3) % picIDs.length;
    counter4 = (counter1+4) % picIDs.length;
    // counter1 last to change
    counter1 = (counter1+1) % picIDs.length;
  }
  function changePicImmediately(){
    changePic(100);
  }
  function playMusic(){
    const piano = $("#piano")[0];
    const playButton = $("#playButton");
    if (playButton.length) {
      playButton.remove();
      piano.play();
    }else{
      if (piano.paused) {
        piano.play();
      } else {
        piano.pause();
      }
    }
  }

  $(function(){
    setTime(new Date());
    document.getElementById("piano").currentTime = 10;

    $("#playButton").on("click",function() {
      playMusic();
    });
    $("#pics").on("click",function() {
      changePicImmediately();
    });
    $("body").on("dblclick", function() {
      playMusic();
    });


    let picHtml = '';
    for (let i = 0; i < picIDs.length; i++) {
      const id = picIDs[i];
      let styleStr = '';
      if (i > 0) {
        styleStr = 'opacity:0; visibility:hidden;'
        if (i > 4){
          styleStr = 'display:none;'
        }
      }
      picHtml += `<div class='full' id='${id}' style='${ styleStr } opacity: 0.6; background-image:url(./pictures/light_${id}.jpg);'></div>`;
    }
    $("#pics").html(picHtml);

    setInterval(function(){
      changePic();
    }, 8 * 1000);
    setInterval(function(){
      setTime(new Date());
    }, 250);
  });
  </script>
  </body>
  </html>
